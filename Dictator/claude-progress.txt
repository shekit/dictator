
## 2026-01-21 - Hybrid Onboarding UX Implementation

**Problem**: User reported that closing onboarding without completing left no way to re-access it until app restart.

**User Request**: "if i launch the dictator app for the first time and then before setting it up, close the onboarding, then there is no way for me to set it up again. the onboarding doesnt trigger the next i double click it until i quit the app from the menu bar"

**Solution Chosen**: Option 3 (Hybrid Approach)
1. Auto-show onboarding on launch if incomplete (up to 3 times)
2. Add "Complete Setup..." menu item for manual access  
3. After 3 dismissals, stop auto-showing but keep menu item available

**Implementation**:
- Added onboardingDismissalCount tracking in UserDefaults
- Modified AppDelegate launch logic to check dismissal count
- Auto-show onboarding only if dismissalCount < 3 OR has in-progress step
- Made showOnboarding() public for menu access
- Added NSWindowDelegate to track window closures
- Increments dismissalCount when window closed without completion
- Initializes services even if onboarding incomplete (so app remains usable)
- Added "Complete Setup..." menu item to StatusBarController
- Menu item only appears when onboarding is not complete
- Added setOnboardingComplete() to update menu visibility

**Testing**: Build successful. Ready for user testing.

**Commit**: 8b8e921 - Implement hybrid onboarding UX with dismissal tracking


## 2026-01-21 - Simplified Onboarding UX

**User Feedback**: "I think we can simplify this, there don't need to be like three dismissals before you stop showing, just always show it till the onboarding has been completed."

**Change**: Removed dismissal count tracking complexity. New simpler behavior:
- Always auto-show onboarding on launch if not completed (no dismissal limit)
- "Complete Setup..." menu item always available if not completed
- User can dismiss and re-launch, onboarding will always show again
- Services initialize even if onboarding dismissed (app remains usable)

**Code changes**:
- Removed onboardingDismissalCount UserDefaults tracking
- Simplified launch logic to just check hasCompletedOnboarding boolean
- Removed dismissal count increment logic from windowWillClose
- Kept manual "Complete Setup..." menu item access

**Result**: Much simpler and more predictable UX. Onboarding always shows until completed, with optional manual access via menu.

**Commit**: 461ac5b - Simplify onboarding UX - always auto-show until complete


## 2026-01-21 - Add fn key label to onboarding

**User Feedback**: "on the first onboarding page where you have that large FN key in blue, that icon doesn't really look like a key. So, just to clarify that it's a key, maybe put a small text under FN, where it says FN, just put FN key as a small text"

**Implementation**: Added small caption text "fn key" directly under the large fn button graphic to clarify it's a keyboard key.

**Code changes**:
- Wrapped fn button ZStack in a VStack with 4pt spacing
- Added Text("fn key") with .caption font and .secondary color
- Maintains visual hierarchy while adding clarity

**Commit**: 50392a3 - Add 'fn key' label to clarify keyboard key on onboarding


## 2026-01-21 - Fix menu bar dropdown not showing

**User Report**: "this is very broken now, if i quit the app without completing the onboarding and click the icon in the menu bar, the menu dropdown doesnt show"

**Root Cause**: During earlier refactoring, we removed `statusItem.menu = menu` assignment. The menu was being built correctly but never assigned to the status item, so clicking the icon showed nothing.

**Fix**: Added `statusItem.menu = menu` in `configureMenu()` after building the initial menu structure.

**Commit**: cba6622 - Fix menu bar dropdown not showing


## 2026-01-21 - Fix onboarding UX issues

**User Report**: 
1. "if i quit the onboarding midway, then i dont see the continue setup button in the menu dropdown and there is no way to retrigger it"
2. "if the onboarding is quit before its completed, quit the app also. right now the icon stays in the menu bar, it shouldnt"

**Root Causes**:

1. **Missing "Complete Setup..." menu item**:
   - `updateLLMMenuItems()` was rebuilding menu from scratch without checking `isOnboardingComplete`
   - When user dismissed onboarding, services initialized anyway
   - Service initialization triggered observers that called `updateLLMMenuItems()`
   - This overwrote the correct menu (which had "Complete Setup...") with incomplete menu
   - User was stuck with no way to re-open onboarding

2. **App not quitting when onboarding dismissed**:
   - `windowWillClose` was calling `initializeServices()` even when onboarding incomplete
   - App stayed running with menu bar icon visible
   - User expected app to quit entirely

**Solutions**:

1. Changed `updateLLMMenuItems()` to call `updateMenuForOnboardingStatus()` instead of building menu directly
   - This ensures onboarding status is always checked when rebuilding menu
   - "Complete Setup..." menu item now persists correctly

2. Changed `windowWillClose` to call `NSApp.terminate(nil)` when onboarding incomplete
   - App now quits cleanly with no menu bar icon remaining
   - Next launch will show onboarding again

**Commit**: 2c0300e - Fix onboarding UX: preserve Complete Setup menu item and quit on dismissal


## 2026-01-21 - Remove redundant Skip button from API key step

**User Feedback**: "on the page where it says enter optional open API router key. We don't need to have three buttons. We don't need to have skip and continue. Just have continue"

**Implementation**: Removed the Skip button from the API key onboarding step. The Continue button now handles both cases automatically:
- If field is empty: continues without saving (same as skip behavior)
- If field is filled: saves API key and continues

**Result**: Cleaner UI with less button clutter, more intuitive flow.

**Commit**: cf0d130 - Remove redundant Skip button from API key onboarding step


## 2026-01-21 - Consolidate reset onboarding into build script

**User Request**: "Can you also consolidate the reset onboarding script into the build app script? Because if I'm building the app, I just want it to reset the onboarding, too."

**Implementation**: Modified build-app.sh to call reset-onboarding.sh before building the app. This ensures:
- Fresh onboarding state every time you build for testing
- reset-onboarding.sh remains separate and independently usable
- Single command workflow for development

**Changes**:
- build-app.sh now calls reset-onboarding.sh at start
- Made reset-onboarding.sh executable (chmod +x)
- Added explanatory comment in build-app.sh header

**Commit**: 23e8dca - Consolidate reset onboarding into build script


## 2026-01-21 - Treat closing onboarding on final step as completion

**User Request**: "One more small thing is that if the onboarding is on the final page where you have to hit finish and in case there the person hits the cross icon instead, then we should still consider it as completed."

**Implementation**: Modified windowWillClose logic in AppDelegate to check the current onboarding step. If user is on step 4 (the final "You're All Set!" page), closing the window is treated as completion instead of dismissal.

**Behavior**:
- **On final step (step 4)**: Closing window = mark as complete, initialize services, stay running
- **On earlier steps (0-3)**: Closing window = quit app (existing behavior)

**Code changes**:
- Check currentOnboardingStep from UserDefaults in windowWillClose
- If step == 4: mark complete, remove step tracking, update menu, initialize services
- If step < 4: quit app as before

**Result**: More forgiving UX - users don't need to click "Finish" if they're already on the final page.

**Commit**: e4dcb9f - Treat closing onboarding on final step as completion


## 2026-01-21 - Add smart Ollama server management

**User Request**: "Okay, don't code this yet, but tell me, is there some way to launch the Olama server from the menu or the settings directly?"
User chose Option C (Smart Helper) with explicit requirement: "just one thing to keep in mind is that suppose they don't have Olama installed or whatever, we should handle any errors with running it gracefully"

**Implementation**: Created OllamaManager singleton to manage Ollama server lifecycle with graceful error handling.

**Features**:
1. **OllamaManager.swift** (new file):
   - Singleton for starting/stopping Ollama server
   - Automatically finds Ollama executable in common paths (/usr/local/bin, /opt/homebrew/bin, etc.)
   - Falls back to 'which' command if not found in common locations
   - Returns (success: Bool, error: String?) for graceful error handling
   - Manages Process lifecycle with proper cleanup

2. **StatusBarController.swift** (modified):
   - When user selects Local mode without Ollama running, shows dialog: "Ollama is not running. Would you like to start it?"
   - On "Start Ollama" click:
     - Attempts to start server via OllamaManager
     - Waits 2 seconds for server startup
     - Refreshes Ollama connection status
     - Shows three-tier feedback:
       - Success: "Ollama Started" confirmation
       - Not responding yet: "Try again in a moment" warning
       - Failed to start: Detailed error message (e.g., "Ollama not found. Install it from ollama.ai")

3. **AppDelegate.swift** (modified):
   - Added OllamaManager.shared.stopOllamaServer() to applicationWillTerminate
   - Ensures clean shutdown of any Ollama server started by the app

**Error Handling**:
- Missing Ollama installation: Clear message with ollama.ai link
- Failed to launch: Shows actual error description
- Server not responding: User-friendly "wait a moment" message
- All errors displayed in appropriate NSAlert dialogs with proper alert styles

**Result**: Users can seamlessly start Ollama from within the app when selecting Local mode, with clear feedback for all scenarios.

**Commit**: 56a94c8 - Add smart Ollama server management with graceful error handling


## 2026-01-21 - Add smart helper to open Settings for API key

**User Request**: "right now when you don't have an API key entered and you click cloud as an option in the menu bar, it very nicely and correctly opens up a pop-up saying you need to enter an API key. But then it tells you where to go in settings as text. Can there be a button there that when you click opens the settings menu to the page where you need to enter it. So basically a smart helper for this as well"

**Implementation**: Modified Cloud mode API key dialog to include smart helper button.

**Changes**:
- Dialog now shows two buttons: "Open Settings" and "Cancel"
- Clicking "Open Settings" directly opens the Settings window (same as menu item)
- Clicking "Cancel" dismisses dialog
- Removed explanatory text about opening Settings (replaced with action button)

**Pattern**: Matches the smart helper approach used for Ollama server management - offer direct action instead of just instructions.

**Result**: Seamless UX - user can go directly from "API key missing" dialog to entering their API key with one click.

**Commit**: 0efa4e9 - Add smart helper to open Settings when API key missing


## 2026-01-21 - Improve Settings navigation and Ollama server management

**User Feedback**:
1. "It opens settings, but it doesn't open the settings tab within settings where the API key needs to be entered. It should open the tab where the API key needs to be entered"
2. "If the OlaMA server was started through this menu bar, then you should have a 'Stop Server' button somewhere inside the settings menu. If I click on Olama again in the menu dropdown itself, when it's already selected and active, then maybe it can show a pop-up saying 'stop server' or 'cancel.'"
3. "Also, make sure that if I switch from Olama to RAW or Cloud, it automatically switches off the server. So that the next time if I click it again, it asks me to restart the server."

**Implementation**: Enhanced Settings navigation and added Ollama server lifecycle management.

**Changes**:

1. **Settings tab navigation**:
   - Modified SettingsWindow to accept `initialTab` parameter
   - Added `openSettings(initialTab:)` method to StatusBarController
   - API key dialog now opens Settings directly to the Settings tab where API key input is located
   - If Settings window already open with wrong tab, closes and reopens with correct tab

2. **Ollama server stop functionality**:
   - Added `isServerRunning` computed property to OllamaManager
   - When clicking Local mode while already selected and server is running:
     - Shows dialog: "Ollama Server Running - Would you like to stop it?"
     - User can choose "Stop Server" or "Cancel"
     - After stopping, refreshes Ollama status
   - Automatic server cleanup when switching modes:
     - When switching from Local to Off or Cloud, automatically stops Ollama server
     - Ensures clean state for next time user selects Local mode
     - Prints log message when auto-stopping

3. **UX improvements**:
   - Seamless workflow: missing API key → click Open Settings → API key input visible immediately
   - Easy server management: click Local when active → stop server option
   - Resource efficiency: server automatically stops when not needed
   - Clean state: switching modes doesn't leave servers running unnecessarily

**Result**: Complete lifecycle management for both settings navigation and Ollama server control, with automatic cleanup and intuitive user interactions.

**Commit**: a4d1a17 - Improve Settings navigation and Ollama server management

